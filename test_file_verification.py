#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞.
"""

import sys
import time
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–æ–¥—É–ª—é
sys.path.insert(0, str(Path(__file__).parent))

from maintenance_alert import _verify_file_write, EXCEL_FILE

def test_file_verification():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞"""
    
    print("=" * 60)
    print("üß™ –¢–ï–°–¢ –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò –í–†–ï–ú–ï–ù–ò –ó–ê–ü–ò–°–ò –§–ê–ô–õ–ê")
    print("=" * 60)
    
    if not EXCEL_FILE.exists():
        print(f"‚ùå –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {EXCEL_FILE}")
        return
    
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–¥–∞—á–∏ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å—Ç–∞—Ä—ã–π —Ä–µ–∂–∏–º)
    print("\n1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏):")
    result1 = _verify_file_write(EXCEL_FILE)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ' if result1 else '‚ùå'}")
    
    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ñ–∞–π–ª –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–æ–±–Ω–æ–≤–ª–µ–Ω")
    print("\n2. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º (—Ñ–∞–π–ª –ù–ï –æ–±–Ω–æ–≤–ª—è–ª—Å—è):")
    current_mtime = EXCEL_FILE.stat().st_mtime
    result2 = _verify_file_write(EXCEL_FILE, current_mtime)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ (–æ–∂–∏–¥–∞–µ–º–æ False)' if not result2 else '‚ùå (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å False)'}")
    
    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ —Å—Ç–∞—Ä—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (—Å–∏–º—É–ª–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞)
    print("\n3. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ —Å—Ç–∞—Ä—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (—Å–∏–º—É–ª–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ):")
    old_mtime = current_mtime - 10.0  # 10 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
    result3 = _verify_file_write(EXCEL_FILE, old_mtime)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ (–æ–∂–∏–¥–∞–µ–º–æ True)' if result3 else '‚ùå (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å True)'}")
    
    # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ–∞–π–ª–æ–º
    print("\n4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞:")
    fake_file = Path("–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π_—Ñ–∞–π–ª.xlsx")
    result4 = _verify_file_write(fake_file, current_mtime)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ (–æ–∂–∏–¥–∞–µ–º–æ False)' if not result4 else '‚ùå (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å False)'}")
    
    print("\n" + "=" * 60)
    print("üìä –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 60)
    
    tests_passed = 0
    total_tests = 4
    
    if result1:  # –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏
        tests_passed += 1
        print("‚úÖ –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ - –ü–†–û–ô–î–ï–ù")
    else:
        print("‚ùå –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ - –ü–†–û–í–ê–õ–ï–ù")
    
    if not result2:  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è
        tests_passed += 1
        print("‚úÖ –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–ô–î–ï–ù")
    else:
        print("‚ùå –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–í–ê–õ–ï–ù")
    
    if result3:  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ —Å—Ç–∞—Ä—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏
        tests_passed += 1
        print("‚úÖ –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–ô–î–ï–ù")
    else:
        print("‚ùå –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–í–ê–õ–ï–ù")
    
    if not result4:  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è
        tests_passed += 1
        print("‚úÖ –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–ô–î–ï–ù")
    else:
        print("‚ùå –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ - –ü–†–û–í–ê–õ–ï–ù")
    
    print(f"\n–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {tests_passed}/{total_tests} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ")
    
    if tests_passed == total_tests:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û!")
        print("–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
    else:
        print("‚ö†Ô∏è –ù–ï –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò")
        print("–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.")

if __name__ == "__main__":
    test_file_verification()
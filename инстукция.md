# Инструкция по использованию таблицы учёта обслуживания оборудования

**Версия системы:** 0.9.2  
**Дата последнего обновления:** 09.08.2025

**Расположение системы:** Файловый сервер АСУ ТП, папка `Y:\Обслуживание оборудования АСУТП\`  или
`\\10.100.59.40\Docs_Storage\Обслуживание оборудования АСУТП`
**Планировщик заданий:** Задача `maintenance_alert.py` на файловом сервере АСУ ТП

✅ **Система готова к работе!** Ежедневно в 07:00 выполняется проверка оборудования из таблицы и отправка уведомлений при необходимости. Все файлы и задачи уже настроены на файловом сервере АСУ ТП.

### Регулярное обслуживание:
1. **После выполнения ТО:**
   - Откройте Excel файл по пути `Y:\Обслуживание оборудования АСУТП\Обслуживание ПК и шкафов АСУТП.xlsx` или `\\10.100.59.40\Docs_Storage\Обслуживание оборудования АСУТП`
   - В строке оборудования измените дату "Дата последнего ТО" на текущую
   - Формулы автоматически пересчитают следующую дату и статус

2. **Добавление нового оборудования:**
   - Заполните новую строку в соответствующем диапазоне
   - Убедитесь, что формулы скопированы в ячейки "Дата следующего ТО" и "Статус"
## Часть 1: Ведение таблицы Excel

### Структура файла:
**Файл:** `Обслуживание ПК и шкафов АСУТП.xlsx`  
**Расположение:** `Y:\Обслуживание оборудования АСУТП\` или  `\\10.100.59.40\Docs_Storage\Обслуживание оборудования АСУТП` 
**Листы:** 
- `ПК АСУ ТП` (диапазон данных: A4:J300)
- `Шкафы АСУ ТП` (диапазон данных: A4:J300)

### Структура таблицы (строка 3 - заголовки):
| №   | Объект | Наименование | Обозначение | Расположение | Интервал ТО (дней) | Напоминание (за дней) | Дата последнего ТО | Дата следующего ТО | Статус |
| --- | ------ | ------------ | ----------- | ------------ | ------------------ | --------------------- | ------------------ | ------------------ | ------ |

### Как заполнять:

#### 1. **Обязательные поля:**
- **№** - порядковый номер
- **Объект** - название объекта (например, "ЗИФ-1")
- **Наименование** - модель/название оборудования
- **Интервал ТО (дней)** - периодичность обслуживания в днях (например, 90, 180)
- **Напоминание (за дней)** - за сколько дней начинать напоминать (например, 7)
- **Дата последнего ТО** - дата последнего обслуживания (формат: ДД.ММ.ГГГГ)

#### 2. **Автоматически рассчитываемые поля:**
- **Дата следующего ТО** - формула: `=Дата последнего ТО + Интервал ТО`
- **Статус** - формула: `=ЕСЛИ(Дата следующего ТО<=СЕГОДНЯ();"СРОЧНО";ЕСЛИ(Дата следующего ТО-СЕГОДНЯ()<=Напоминание;"Внимание";"В норме"))`

#### 3. **Пример заполнения строки:**

| №   | Объект | Наименование | Обозначение ПК | Место расположения | Интервал ТО | Напоминание | Дата последнего ТО | Дата следующего ТО | Статус                                                                    |
| --- | ------ | ------------ | -------------- | ------------------ | ----------- | ----------- | ------------------ | ------------------ | ------------------------------------------------------------------------- |
| 1   | ЗИФ-1  | Шкаф ПЛК     | 991CS110A01    | ККД                | 31          | 3           | 09.08.2025         | =G2+D2             | =ЕСЛИ(I2<=СЕГОДНЯ();"СРОЧНО";ЕСЛИ(I2-СЕГОДНЯ()<=H2;"Внимание";"В норме")) |

### Важные правила:
1. Заполняйте только **диапазоны A4:J300** (ПК) и **A4:J300** (Шкафы)
2. Не изменяйте структуру таблицы
3. Используйте правильный формат дат: **ДД.ММ.ГГГГ**
4. После ввода даты последнего ТО - формулы автоматически пересчитают следующую дату и статус

---

## Часть 2: Настройка скрипта Python

### 1. **Установка Python и библиотек:**

Если Python еще не установлен:
1. Скачайте Python с [python.org](https://www.python.org/downloads/)
2. Установите с опцией "Add to PATH"

Установка необходимых библиотек:
```cmd
python -m pip install pandas openpyxl
```

### 2. **Расположение файлов:**

Все файлы системы расположены на файловом сервере АСУ ТП:
```
Y:\Обслуживание оборудования АСУТП\
или 
\\10.100.59.40\Docs_Storage\Обслуживание оборудования АСУТП
├── maintenance_alert.py          # Скрипт Python
├── Обслуживание ПК и шкафов АСУТП.xlsx  # Excel файл

```

### 3. **Настройка скрипта:**

Скрипт уже настроен для работы с указанным расположением файлов. При необходимости можно изменить:

#### Настройки email:
```python
SMTP_SERVER = "mgd-ex1.pavlik-gold.ru"
SMTP_PORT = 25
SENDER_EMAIL = "maintenance.asutp@pavlik-gold.ru"  # Ваш email отправителя
```

#### Список получателей:
```python
RECIPIENTS = [
    "asutp@pavlik-gold.ru",
    "ochkur.evgeniy@pavlik-gold.ru",
    "dorovik.roman@pavlik-gold.ru",
    # Добавьте нужные email адреса
]
```

### 3. **Запуск скрипта:**
В консоли (cmd или WPS), перейти в папку с скриптом, и выполнить команду:
```cmd
python maintenance_alert.py
```

---

## Часть 3: Настройка планировщика заданий Windows

### Важно:
**Задача планировщика уже создана на файловом сервере АСУ ТП** и называется `maintenance_alert.py`

### 1. **Параметры существующей задачи:**

- **Имя задачи:** `maintenance_alert.py`
- **Расположение:** Файловый сервер АСУ ТП
- **Время выполнения:** Ежедневно в 07:00
- **Скрипт:** `Y:\Обслуживание оборудования АСУТП\maintenance_alert.py`

### 2. **Просмотр и редактирование задачи:**

1. **Откройте "Планировщик заданий"** на сервере АСУ ТП:
   - Пуск → Планировщик заданий
   - Или `taskschd.msc`

2. **Найдите задачу:**
   - Библиотека планировщика заданий → Задачи планировщика заданий
   - Найдите `maintenance_alert.py`

3. **Для редактирования:**
   - Правая кнопка мыши → Свойства

### 3. **Тестирование задачи:**

1. В планировщике заданий:
   - Найдите задачу `maintenance_alert.py`
   - Правая кнопка мыши → Запустить

2. Проверьте результат:
   - Система выполнит проверку и отправит уведомления при необходимости

---

## Часть 4: Обслуживание и устранение неполадок

### Возможные проблемы:

#### Проблема: "Файл не найден"
**Решение:**
- Убедитесь, что обращаетесь к правильному пути: `Y:\Обслуживание оборудования АСУТП\`
- Проверьте наличие файла `Обслуживание ПК и шкафов АСУТП.xlsx`

#### Проблема: "Ошибка отправки email"
**Решение:**
- Проверьте настройки SMTP сервера
- Убедитесь, что сервер `mgd-ex1.pavlik-gold.ru` доступен
- Проверьте email отправителя и получателей

#### Проблема: "Python не найден"
**Решение:**
- Убедитесь, что Python установлен на сервере
- Проверьте, что Python добавлен в PATH
- Или укажите полный путь к python.exe

### Мониторинг работы:

Проверяйте логи выполнения задачи в планировщике:
1. Откройте планировщик заданий на сервере АСУ ТП
2. Найдите задачу `maintenance_alert.py`
3. Вкладка "Журнал" - здесь будут показаны результаты выполнения

---

## 🛠 Администрирование системы:

### Изменение расписания:
- Откройте планировщик заданий
- Найдите задачу `maintenance_alert.py`
- Перейдите на вкладку "Триггеры"
- Отредактируйте существующий триггер или создайте новый

### Изменение списка получателей:
- Откройте файл `Y:\Обслуживание оборудования АСУТП\maintenance_alert.py`
- Найдите раздел `RECIPIENTS`
- Измените список email адресов
- Сохраните файл

### Обновление версии скрипта:
- Замените файл `maintenance_alert.py` новой версией


